<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Ki·∫øn An</title>
    <style>
        /* --- GI·ªÆ NGUY√äN C√ÅC STYLE C≈® --- */
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Verdana', sans-serif; background: #000; color: white; }
        .scene { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; display: none; flex-direction: column; align-items: center; justify-content: center; transition: opacity 1s; }
        .active { display: flex; }
        #scene1 { background: #2c3e50; }
        .character-img { width: 300px; height: auto; cursor: pointer; animation: bounce 2s infinite; }
        .dialogue-box { background: rgba(255, 255, 255, 0.95); color: #333; padding: 25px; border-radius: 20px; text-align: center; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); width: 400px; max-width: 90%; }
        .btn { background: #e74c3c; color: white; border: none; padding: 12px 30px; font-size: 18px; border-radius: 50px; cursor: pointer; margin-top: 15px; font-weight: bold; transition: 0.3s; }
        .btn:hover { transform: scale(1.1); background: #c0392b; }
        #scene3 { background: url('nhahang.jpg') no-repeat center center; background-size: cover; position: relative; }
        .painting-zone { position: absolute; cursor: pointer; z-index: 10; }
        #paint1 { top: 20%; left: 5%; width: 25vw; height: 35vw; }
        #paint2 { top: 20%; left: 37.5%; width: 25vw; height: 35vw; }
        #paint3 { top: 20%; left: 70%; width: 25vw; height: 35vw; }
        
        .special-modal-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 200; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            transition: background 2s;
        }

        /* Thanh cu·ªôn cho n·ªôi dung d√†i */
        .special-content { 
            text-align: center; max-width: 800px; padding: 20px; 
            animation: fadeIn 1s; 
            display: flex; flex-direction: column; align-items: center;
            max-height: 90vh; 
            overflow-y: auto; 
        }
        .special-content::-webkit-scrollbar { width: 5px; }
        .special-content::-webkit-scrollbar-thumb { background: #888; border-radius: 5px; }

        /* ·∫¢nh k√Ω ·ª©c */
        .memory-img-single { width: 250px; border-radius: 15px; border: 4px solid white; box-shadow: 0 0 20px rgba(255,255,255,0.5); margin-bottom: 20px; display: none; }
        
        /* Gallery 4 ·∫£nh */
        .memory-gallery { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; width: 100%; flex-wrap: wrap; }
        .gallery-img { width: 22%; max-width: 150px; height: auto; border-radius: 10px; border: 2px solid white; box-shadow: 0 0 15px rgba(255,255,255,0.3); display: none; animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        /* Icon v√† Text */
        .sad-mode { filter: grayscale(100%); background: rgba(50, 50, 50, 0.95) !important; }
        #big-sad-icon { font-size: 100px; margin-bottom: 20px; display: none; animation: fadeIn 1s; }
        #cool-icon { font-size: 80px; margin-top: 10px; display: none; animation: popIn 1s infinite alternate; } 
        
        .typing-text { font-size: 1.3em; line-height: 1.6; min-height: 60px; margin-bottom: 20px; color: #fff; text-shadow: 1px 1px 5px black; white-space: pre-wrap; }
        
        /* N√∫t b·∫•m l·ª±a ch·ªçn */
        .choice-container { display: none; gap: 20px; justify-content: center; }
        .choice-btn { padding: 15px 25px; border: none; border-radius: 10px; font-size: 1.1em; cursor: pointer; transition: 0.3s; }
        .btn-yes { background: #2ecc71; color: white; }
        .btn-no { background: #95a5a6; color: white; }
        .choice-btn:hover { transform: scale(1.1); }
        
        /* N√∫t chuy·ªÉn ti·∫øp */
        .next-btn { 
            display: none; 
            margin-top: 20px; 
            margin-bottom: 20px; 
            background: linear-gradient(45deg, #f1c40f, #e67e22); color: white; padding: 15px 30px; border-radius: 50px; font-weight: bold; border: 2px solid white; animation: pulse 2s infinite; cursor: pointer; 
        }
        
        /* --- STYLE CHO M√ÄN FINAL (B√ÅNH KEM) --- */
        #final-party-container {
            display: none; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; 
            margin-bottom: 30px; 
        }
        #cake-img { width: 300px; animation: bounce 3s infinite; margin-bottom: 20px; filter: drop-shadow(0 0 20px gold); }
        .final-wish { 
            font-size: 1.4em; color: #f1c40f; text-shadow: 2px 2px 4px #000; 
            font-weight: bold; text-align: center; line-height: 1.8;
            background: rgba(0,0,0,0.8); 
            padding: 20px; border-radius: 20px;
            border: 2px solid gold;
        }

        /* N√∫t ƒë√≥ng: m·∫∑c ƒë·ªãnh s·∫Ω ·∫©n trong JS v√† hi·ªán sau */
        .close-special-btn { 
            padding: 10px 25px; 
            background: #e74c3c; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 1.1em; 
            margin-top: 20px; 
            margin-bottom: 50px; 
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n trong CSS lu√¥n cho ch·∫Øc */
        }
        
        .cake-container { position: absolute; bottom: 10%; text-align: center; width: 100%; z-index: 5; pointer-events: none; }
        .message-box { background: rgba(0, 0, 0, 0.6); padding: 20px; border-radius: 15px; display: inline-block; max-width: 80%; }
        .message-text { font-size: 1.5em; color: #f1c40f; text-shadow: 1px 1px 2px #000; font-weight: bold; margin: 0; }
        
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .confetti { position: absolute; width: 10px; height: 10px; background: #f00; animation: fall linear forwards; pointer-events: none; z-index: 9999; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
    </style>
</head>
<body>
    <div id="scene1" class="scene active">
        <img src="boy.jpg" class="character-img" alt="Boy">
        <div class="dialogue-box">
            <h2>H·∫ø l√¥ Ki·∫øn An! üëã</h2>
            <p>T·ªõ c√≥ m·ªôt ƒëi·ªÅu b·∫•t ng·ªù si√™u ƒë·∫∑c bi·ªát d√†nh cho c·∫≠u ƒë√¢y.</p>
            <button class="btn" onclick="startJourney()">ƒêi theo t·ªõ n√†o ‚ù§Ô∏è</button>
        </div>
    </div>

    <div id="scene3" class="scene">
        <div id="paint1" class="painting-zone" onclick="openSpecialStory1()"></div>
        <div id="paint2" class="painting-zone" onclick="openSpecialStory2()"></div>
        <div id="paint3" class="painting-zone" onclick="openSpecialStory3()"></div>
        
        <div class="cake-container">
            <div class="message-box">
                <p class="message-text">
                    C·∫≠u h√£y ng·ªìi v√†o b√†n v√† nh√¨n th·∫•y 3 b·ª©c tranh kh√¥ng?<br>
                    C·∫≠u th·ª≠ nh·∫•n v√†o ch√∫ng coi c√≥ g√¨ b·∫•t ng·ªù h√¥ng n√®! üëá
                </p>
            </div>
        </div>
    </div>

    <div id="special-modal-1" class="special-modal-container">
        <div class="special-content">
            <img src="an.jpg" id="an-img" class="memory-img-single" alt="Memory 1">
            <div id="big-sad-icon">üòî</div>
            <div id="typing-area-1" class="typing-text"></div>
            <div id="choices" class="choice-container">
                <button class="choice-btn btn-yes" onclick="chooseOption('yes')">T·∫•t nhi√™n l√† v·∫´n c√≤n r·ªìi ü•∞</button>
                <button class="choice-btn btn-no" onclick="chooseOption('no')">H√¨nh nh∆∞ ƒë√£ qu√™n m·∫•t r·ªìi üòî</button>
            </div>
            <button id="next-paint-btn-1" class="next-btn" onclick="goToPaint2From1()">
                B·∫°n c√≥ mu·ªën xem tranh th·ª© 2 kh√¥ng? üëâ
            </button>
            <button id="close-btn-1" class="close-special-btn" onclick="closeSpecialStory1()">ƒê√≥ng l·∫°i</button>
        </div>
    </div>

    <div id="special-modal-2" class="special-modal-container">
        <div class="special-content">
            <div class="memory-gallery">
                <img src="you.jpg" id="gallery-img-1" class="gallery-img" alt="Memory you">
                <img src="y1.jpg" id="gallery-img-2" class="gallery-img" alt="Memory y1">
                <img src="y2.jpg" id="gallery-img-3" class="gallery-img" alt="Memory y2">
                <img src="y3.jpg" id="gallery-img-4" class="gallery-img" alt="Memory y3">
            </div>
            
            <div id="typing-area-2" class="typing-text" style="font-size: 1.1em;"></div>
            
            <div id="cool-icon">üòé</div>

            <button id="next-paint-btn-2" class="next-btn" onclick="goToPaint3From2()">
                Gi·ªù xem tranh th·ª© 3 n√® üëâ
            </button>
            
            <button id="close-btn-2" class="close-special-btn" onclick="closeSpecialStory2()">ƒê√≥ng l·∫°i</button>
        </div>
    </div>

    <div id="special-modal-3" class="special-modal-container">
        <div class="special-content">
            
            <div id="boy-talk-area">
                <img src="boy.jpg" class="memory-img-single" style="display:inline-block; border-color: #f1c40f;" alt="Boy talking">
                <div id="typing-area-3" class="typing-text"></div>
                
                <button id="open-gift-btn" class="next-btn" onclick="triggerFinalSurprise()">
                    Gi·ªù xem tranh th·ª© 3 n√® (B·∫•t ng·ªù) üéÅ
                </button>
            </div>

            <div id="final-party-container">
                <h1 style="color: #f1c40f; text-shadow: 0 0 10px red; font-size: 3em; margin:0;">HAPPY BIRTHDAY!!!!</h1>
                <div style="font-size: 50px;">üéÜ üéÇ üíê</div>
                
                <img src="banh.png" id="cake-img" alt="Birthday Cake">
                
                <div id="final-wish-area" class="final-wish"></div>
            </div>

            <button id="close-btn-3" class="close-special-btn" onclick="closeSpecialStory3()">ƒê√≥ng l·∫°i</button>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <audio id="hpbdMusic">
        <source src="hpbd.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- KH·ªûI ƒê·∫¶U ---
        function startJourney() {
            document.getElementById('scene1').classList.remove('active');
            document.getElementById('scene3').classList.add('active');
            var audio = document.getElementById("bgMusic");
            audio.play().catch(e => console.log("Audio blocked"));
            createConfettiLoop(5000);
        }

        // --- TRANH 1: NG∆Ø·ªúI C≈® ---
        function openSpecialStory1() {
            resetSpecialModal1();
            document.getElementById('special-modal-1').style.display = 'flex';
            setTimeout(() => { document.getElementById('an-img').style.display = 'inline-block'; }, 500);
            setTimeout(() => {
                typeText("C·∫≠u th·∫•y ai quen quen hong n√®?<br>N·ª• c∆∞·ªùi ƒë√≥ gi·ªù c·∫≠u c√≥ c√≤n ·ªü tr√™n m√¥i ko n√®? üòä", "typing-area-1");
            }, 1500);
            setTimeout(() => { document.getElementById('choices').style.display = 'flex'; }, 4000);
        }
        function resetSpecialModal1() {
            document.getElementById('an-img').style.display = 'none';
            document.getElementById('big-sad-icon').style.display = 'none';
            document.getElementById('typing-area-1').innerHTML = '';
            document.getElementById('choices').style.display = 'none';
            document.getElementById('next-paint-btn-1').style.display = 'none';
            document.getElementById('close-btn-1').style.display = 'none'; // ·∫®n n√∫t ƒë√≥ng
            document.getElementById('special-modal-1').classList.remove('sad-mode');
        }
        function closeSpecialStory1() {
            document.getElementById('special-modal-1').style.display = 'none';
        }
        function chooseOption(choice) {
            document.getElementById('choices').style.display = 'none';
            if (choice === 'yes') {
                typeText("Ch√∫c m·ª´ng nha! üéâ<br>C·∫≠u v·∫´n c√≤n gi·ªØ ƒë∆∞·ª£c n·ª• c∆∞·ªùi ƒë√≥ tr√¥ng c·∫≠u th·∫≠t vui v·∫ª lu√¥n ƒë√≥.<br>H√£y lu√¥n gi·ªØ n·ª• c∆∞·ªùi ƒë√≥ tr√™n m√¥i ho√†i lu√¥n nha!<br>CH√öC M·ª™NG C·∫¨U!", "typing-area-1");
                createConfettiLoop(5000);
            } else {
                document.getElementById('special-modal-1').classList.add('sad-mode');
                document.getElementById('an-img').style.display = 'none';
                document.getElementById('big-sad-icon').style.display = 'block';
                typeText("Kh√¥ng sao ƒë√¢u, c·∫≠u v·∫´n c√≤n ·ªü ƒë√¢y l√† t·ªët r·ªìi n√®...<br>Cu·ªôc s·ªëng hi·ªán gi·ªù ch·∫Øc c·∫≠u v·∫•t v·∫£ l·∫Øm nh·ªâ?<br>Nh∆∞ng ko sao ƒë√¢u, t·ªõ tin l√† sau c∆°n m∆∞a tr·ªùi s·∫Ω s√°ng m√†.<br>C·∫≠u ch·ªâ c·∫ßn c·ªë g·∫Øng th√™m ch√∫t n·ªØa th√¥i, r·ªìi m·ªôt ng√†y n√†o ƒë√≥ n·ª• c∆∞·ªùi ƒë√≥ s·∫Ω xu·∫•t hi·ªán l·∫°i ti·∫øp th√¥i n√®! üòî", "typing-area-1");
            }
            // Hi·ªán c·∫£ 2 n√∫t c√πng l√∫c sau 10s
            setTimeout(() => { 
                document.getElementById('next-paint-btn-1').style.display = 'block'; 
                document.getElementById('close-btn-1').style.display = 'block'; 
            }, 10000); 
        }
        function goToPaint2From1() {
            document.getElementById('special-modal-1').style.display = 'none';
            setTimeout(() => { openSpecialStory2(); }, 500);
        }

        // --- TRANH 2: H√ÄO H√ôNG ---
        function openSpecialStory2() {
            document.getElementById('gallery-img-1').style.display = 'none';
            document.getElementById('gallery-img-2').style.display = 'none';
            document.getElementById('gallery-img-3').style.display = 'none';
            document.getElementById('gallery-img-4').style.display = 'none';
            document.getElementById('typing-area-2').innerHTML = '';
            document.getElementById('cool-icon').style.display = 'none';
            document.getElementById('next-paint-btn-2').style.display = 'none';
            document.getElementById('close-btn-2').style.display = 'none'; // ·∫®n n√∫t ƒë√≥ng ban ƒë·∫ßu
            
            document.getElementById('special-modal-2').style.display = 'flex';
            
            setTimeout(() => { document.getElementById('gallery-img-1').style.display = 'block'; }, 500);
            setTimeout(() => { document.getElementById('gallery-img-2').style.display = 'block'; }, 1000);
            setTimeout(() => { document.getElementById('gallery-img-3').style.display = 'block'; }, 1500);
            setTimeout(() => { document.getElementById('gallery-img-4').style.display = 'block'; }, 2000);

            setTimeout(() => {
                const content = `C·∫≠u nh·ªõ nƒÉm ƒë√≥ ch√∫ng ta l√† ng∆∞·ªùi nh∆∞ th·∫ø n√†o ch·ª© n√®?

Ch√∫ng ta ƒë·ªÅu l√† thi·∫øu ni√™n, thua ko bu·ªìn, th·∫Øng ko khi√™m nh∆∞·ªùng. Trong tay c√≥ vi·∫øt, trong l√≤ng c√≥ ch√≠. G·∫∑p bi·ªÉn l·ªõn, l√≤ng ta ph√≥ng kho√°ng. G·∫∑p hoa n·ªü c≈©ng kh√¥ng gi·∫•u ni·ªÅm vui. Ph√≠a tr∆∞·ªõc hi·ªÉm nguy ch·∫≥ng bi·∫øt s·ª£. B·∫°n b√® ·ªü b√™n n√¢ng ch√©n h√°t vang. Mu·ªën c∆∞·ªùi th√¨ to ti·∫øng c∆∞·ªùi vang. Mu·ªën ch·ª≠i th√¨ ch·ª≠i cho ƒë√£ mi·ªáng.

ƒê·∫°o l√Ω nh√¢n gian mu√¥n quy·ªÉn s√°ch. Ch·ªâ mong ƒë∆∞·ª£c t√πy √Ω theo l√≤ng n√†y.`;
                typeText(content, "typing-area-2");
            }, 3000);

            // Hi·ªán t·∫•t c·∫£ n√∫t c√πng l√∫c khi ch·∫°y ch·ªØ xong (18s)
            setTimeout(() => {
                document.getElementById('cool-icon').style.display = 'block';
                document.getElementById('next-paint-btn-2').style.display = 'block';
                document.getElementById('close-btn-2').style.display = 'block'; // Gi·ªù m·ªõi hi·ªán n√∫t ƒë√≥ng
            }, 18000); 
        }
        function closeSpecialStory2() {
            document.getElementById('special-modal-2').style.display = 'none';
        }

        function goToPaint3From2() {
            document.getElementById('special-modal-2').style.display = 'none';
            setTimeout(() => { openSpecialStory3(); }, 500);
        }

        // --- TRANH 3: ƒê·ªàNH CAO & B√ÅNH KEM ---
        function openSpecialStory3() {
            document.getElementById('special-modal-3').style.display = 'flex';
            
            document.getElementById('boy-talk-area').style.display = 'block';
            document.getElementById('final-party-container').style.display = 'none';
            document.getElementById('open-gift-btn').style.display = 'none';
            document.getElementById('close-btn-3').style.display = 'none'; // ·∫®n n√∫t ƒë√≥ng
            document.getElementById('typing-area-3').innerHTML = '';

            setTimeout(() => {
                const content = `C·∫≠u th·∫•y ·∫•y nƒÉm ƒë√≥ ch√∫ng ta ƒë·ªÅu nh∆∞ v·∫≠y ƒë√≥ n√™n b√¢y gi·ªù ch√∫ng ta ƒë·ªÅu ph·∫£i ti·∫øp t·ª•c ti·∫øn l√™n v∆∞∆°n l√™n ƒë·ªânh cao c·ªßa cu·ªôc ƒë·ªùi nha.

L·∫ßn sau g·∫∑p l·∫°i l√† ·ªü ƒë·ªânh cao vinh quang nha c√πng v·ªõi kh√≠ ph√°ch thi·∫øu ni√™n nƒÉm x∆∞a ko h·ªÅ suy gi·∫£m m√† c√†ng l·ªõn m·∫°nh th√™m nha n√®.

V√† sau ƒë√¢y l√† ƒëi·ªÅu ƒë·∫∑c bi·ªát cho c·∫≠u n√®. üëá`;
                typeText(content, "typing-area-3");
            }, 1000);

            // HI·ªÜN N√öT QU√Ä & ƒê√ìNG SAU 5 GI√ÇY
            setTimeout(() => {
                document.getElementById('open-gift-btn').style.display = 'block';
                document.getElementById('close-btn-3').style.display = 'block';
            }, 5000);
        }

        function triggerFinalSurprise() {
            document.getElementById('boy-talk-area').style.display = 'none';
            document.getElementById('final-party-container').style.display = 'flex';
            // N√∫t ƒë√≥ng v·∫´n gi·ªØ nguy√™n ·ªü ƒë√≥ ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ th·ªÉ tho√°t

            // 1. T·∫ÆT NH·∫†C N·ªÄN C≈®
            var bgAudio = document.getElementById("bgMusic");
            bgAudio.pause();
            
            // 2. CH∆†I NH·∫†C HPBD M·ªöI
            var hpbdAudio = document.getElementById("hpbdMusic");
            hpbdAudio.currentTime = 0;
            hpbdAudio.play().catch(e => console.log("C·∫ßn file hpbd.mp3 ƒë·ªÉ ph√°t nh·∫°c"));

            createConfettiLoop(20000); 

            const wish = `Ch√∫c m·ª´ng sinh nh·∫≠t Ki·∫øn An üéÜüéÇüíê

Ch√∫c √¥ng v·∫°n s·ª± nh∆∞ √Ω, h√†ng gi·ªù h·∫°nh ph√∫c, h√†ng ng√†n y√™u th∆∞∆°ng.
H√†ng gi√¢y ti·ªÅn v√†o t√∫i ƒë·ªÅu ƒë·ªÅu, v√† lu√¥n vui v·∫ª nha √¥ng.

HAPPY BIRTHDAY!!!!`;
            typeText(wish, "final-wish-area");
        }

        function closeSpecialStory3() {
            document.getElementById('special-modal-3').style.display = 'none';
            // B·∫≠t l·∫°i nh·∫°c n·ªÅn n·∫øu mu·ªën
            document.getElementById("bgMusic").play();
            document.getElementById("hpbdMusic").pause();
        }

        // --- TI·ªÜN √çCH ---
        function typeText(text, elementId) {
            const el = document.getElementById(elementId);
            el.style.opacity = 1;
            el.innerHTML = text.replace(/\n/g, "<br>"); 
            el.animate([{ opacity: 0 }, { opacity: 1 }], { duration: 1000, fill: 'forwards' });
        }

        function createConfettiLoop(duration) {
            let interval = setInterval(() => {
                const colors = ['#f1c40f', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#ffffff', 'gold'];
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 15 + 5 + 'px';
                confetti.style.height = Math.random() * 15 + 5 + 'px';
                confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(confetti);
                setTimeout(() => { confetti.remove() }, 3000);
            }, 50);

            setTimeout(() => { clearInterval(interval); }, duration);
        }
    </script>
</body>
</html>
